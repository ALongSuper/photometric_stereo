<!--
 * @Descripttion: 
 * @version: 
 * @Author: SJL
 * @Date: 2024-07-17 08:57:17
 * @LastEditors: SJL
 * @LastEditTime: 2024-12-25 16:46:32
-->
# 介绍

 &ensp;光度立体法是一种三维重建方法，在一些表面产品的缺陷检测有较多的应用(一般是具有深度的缺陷)，但是光度立体法需要对每个像素点都求解一个线性方程组 L(n*3) * N(3*1) = I(n*1) （n为光源数），在cpu中计算是非常耗时的，本方法借助libtorch在gpu中通过卷积的方式，实现方程组的并行求解，耗时大约为cpu中的2%,具有明显的提速效果。 

## Step1、光源方向标定
计算标定球在不同光源下的灰度重心坐标位置，然后根据标定球的半径与圆心，计算出每个光源在三维空间中的方向向量
## Step2、数据转换，求解
1. 将n个光源对应的图像merge为一张n通道的图像，并转为float型，然后转为pytorch中 1 * n * height * width 的张量
2. 将标定得到的光源方向矩阵求逆，并转到pytorch中，作为卷积运算的权重(3 * n)
3. 创建Conv2d卷积层，设置权重与输入，然后进行forward运算，得到 1 * 3 * height * width 的结果
## step3、结果图重建
1. 对得到的结果在第二维度(通道)进行归一化，模的大小即反照率，将norm转为mat,得到反照率图
2. 归一化后的张量即法向量的单位向量，利用法向量进行三维重建，在频域中，从(0,0)点开始，沿着x和y方向，计算相对高度，得到深度图(在频域对梯度进行积分，即求解泊松方程)
3. 计算法向量与相机方向(0,0,1)的夹角角度，得到法向角度图
4. 利用梯度计算平均曲率图和旋度图
